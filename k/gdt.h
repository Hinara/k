#ifndef GDT_H_
#define GDT_H_


#define GDT_ENTRY(base, limit, flags)		\
	((((base)  & 0xff000000ULL) << (56-24)) | \
	 (((flags) & 0x0000f0ffULL) << 40)	| \
	 (((limit) & 0x000f0000ULL) << (48-16)) | \
	 (((base)  & 0x00ffffffULL) << 16)	| \
	 (((limit) & 0x0000ffffULL)))

#define GDT_GRANILARITY_BIT	0b0000000000000000
#define GDT_GRANILARITY_PAGE	0b1000000000000000

#define GDT_SIZE_16		0b0000000000000000
#define GDT_SIZE_32		0b0100000000000000

#define GDT_PRESENT		0b0000000010000000

#define GDT_RING0		0b0000000000000000
#define GDT_RING1		0b0000000000100000
#define GDT_RING2		0b0000000001000000
#define GDT_RING3		0b0000000001100000

#define GDT_TYPE_CODE		0b0000000000010000
#define GDT_TYPE_DATA		0b0000000000010000
#define GDT_TYPE_SYSTEM		0b0000000000000000

#define GDT_EXECUTABLE		0b0000000000001000

#define GDT_CODE_READABLE	0b0000000000000010
#define GDT_DATA_WRITABLE	0b0000000000000010

#define GDT_DIR_UP		0b0000000000000000
#define GDT_DIR_DOWN		0b0000000000000100

#define GDT_ACCESSED		0b0000000000000001


#define GDT_KERNEL_CS_FLAGS	GDT_GRANILARITY_PAGE | GDT_SIZE_32 | \
				GDT_PRESENT | GDT_RING0 | GDT_TYPE_CODE | \
				GDT_EXECUTABLE | GDT_CODE_READABLE

#define GDT_KERNEL_DS_FLAGS	GDT_GRANILARITY_PAGE | GDT_SIZE_32 | \
				GDT_PRESENT | GDT_RING0 | GDT_TYPE_DATA | \
				GDT_DATA_WRITABLE

#define GDT_USER_CS_FLAGS	GDT_GRANILARITY_PAGE | GDT_SIZE_32 | \
				GDT_PRESENT | GDT_RING3 | GDT_TYPE_CODE | \
				GDT_EXECUTABLE | GDT_CODE_READABLE

#define GDT_USER_DS_FLAGS	GDT_GRANILARITY_PAGE | GDT_SIZE_32 | \
				GDT_PRESENT | GDT_RING3 | GDT_TYPE_DATA | \
				GDT_DATA_WRITABLE

#define GDT_KERNEL_ENTRY_CS 1
#define GDT_KERNEL_ENTRY_DS 2
#define GDT_USER_ENTRY_CS 3
#define GDT_USER_ENTRY_DS 4

#define GDT_OFFSET_FROM_ENTRY(x) (x*8)

#define GDT_KERNEL_CS GDT_OFFSET_FROM_ENTRY(GDT_KERNEL_ENTRY_CS)
#define GDT_KERNEL_DS GDT_OFFSET_FROM_ENTRY(GDT_KERNEL_ENTRY_DS)
#define GDT_USER_CS GDT_OFFSET_FROM_ENTRY(GDT_USER_ENTRY_CS)
#define GDT_USER_DS GDT_OFFSET_FROM_ENTRY(GDT_USER_ENTRY_DS)

#ifndef __ASSEMBLER__

void set_gdt();

#endif

#endif /* GDT_H_ */